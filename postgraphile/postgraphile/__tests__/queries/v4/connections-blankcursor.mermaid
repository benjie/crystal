%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    __InputStaticLeaf7{{"__InputStaticLeaf[7∈0]"}}:::plan
    __InputStaticLeaf11{{"__InputStaticLeaf[11∈0]"}}:::plan
    Access16{{"Access[16∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Object18{{"Object[18∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Lambda20{{"Lambda[20∈0]<br />ᐸparseCursorᐳ"}}:::plan
    Connection19{{"Connection[19∈0]<br />ᐸ15ᐳ"}}:::plan
    PgPageInfo21{{"PgPageInfo[21∈1]"}}:::plan
    PgValidateParsedCursor26["PgValidateParsedCursor[26∈1]"]:::plan
    Access27{{"Access[27∈1]<br />ᐸ20.1ᐳ"}}:::plan
    ToPg28["ToPg[28∈1]"]:::plan
    PgSelect22[["PgSelect[22∈1]<br />ᐸperson+1ᐳ"]]:::plan
    First23{{"First[23∈1]"}}:::plan
    PgSelectSingle24{{"PgSelectSingle[24∈1]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression29{{"PgClassExpression[29∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    List30{{"List[30∈1]<br />ᐸ29ᐳ"}}:::plan
    PgCursor25{{"PgCursor[25∈1]"}}:::plan
    Last32{{"Last[32∈1]"}}:::plan
    PgSelectSingle33{{"PgSelectSingle[33∈1]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression38{{"PgClassExpression[38∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    List39{{"List[39∈1]<br />ᐸ38ᐳ"}}:::plan
    PgCursor34{{"PgCursor[34∈1]"}}:::plan
    Lambda41{{"Lambda[41∈1]<br />ᐸlistHasMoreᐳ"}}:::plan
    Constant45{{"Constant[45∈1]"}}:::plan
    PgSelect46[["PgSelect[46∈1]<br />ᐸperson(aggregate)ᐳ"]]:::plan
    First47{{"First[47∈1]"}}:::plan
    PgSelectSingle48{{"PgSelectSingle[48∈1]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression49{{"PgClassExpression[49∈1]<br />ᐸcount(*)ᐳ"}}:::plan
    __Item54[/"__Item[54∈2]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelectSingle55{{"PgSelectSingle[55∈2]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression57{{"PgClassExpression[57∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    List58{{"List[58∈3]<br />ᐸ57ᐳ"}}:::plan
    PgCursor56{{"PgCursor[56∈3]"}}:::plan
    PgClassExpression60{{"PgClassExpression[60∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgClassExpression61{{"PgClassExpression[61∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgClassExpression62{{"PgClassExpression[62∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgClassExpression63{{"PgClassExpression[63∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    __InputStaticLeaf64{{"__InputStaticLeaf[64∈0]"}}:::plan
    __InputStaticLeaf68{{"__InputStaticLeaf[68∈0]"}}:::plan
    Lambda77{{"Lambda[77∈0]<br />ᐸparseCursorᐳ"}}:::plan
    Connection76{{"Connection[76∈0]<br />ᐸ72ᐳ"}}:::plan
    PgPageInfo78{{"PgPageInfo[78∈4]"}}:::plan
    PgValidateParsedCursor83["PgValidateParsedCursor[83∈4]"]:::plan
    Access84{{"Access[84∈4]<br />ᐸ77.1ᐳ"}}:::plan
    ToPg85["ToPg[85∈4]"]:::plan
    PgSelect79[["PgSelect[79∈4]<br />ᐸperson+1ᐳ"]]:::plan
    First80{{"First[80∈4]"}}:::plan
    PgSelectSingle81{{"PgSelectSingle[81∈4]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression86{{"PgClassExpression[86∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    List87{{"List[87∈4]<br />ᐸ86ᐳ"}}:::plan
    PgCursor82{{"PgCursor[82∈4]"}}:::plan
    Last89{{"Last[89∈4]"}}:::plan
    PgSelectSingle90{{"PgSelectSingle[90∈4]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression95{{"PgClassExpression[95∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    List96{{"List[96∈4]<br />ᐸ95ᐳ"}}:::plan
    PgCursor91{{"PgCursor[91∈4]"}}:::plan
    Lambda98{{"Lambda[98∈4]<br />ᐸlistHasMoreᐳ"}}:::plan
    Constant102{{"Constant[102∈4]"}}:::plan
    PgSelect103[["PgSelect[103∈4]<br />ᐸperson(aggregate)ᐳ"]]:::plan
    First104{{"First[104∈4]"}}:::plan
    PgSelectSingle105{{"PgSelectSingle[105∈4]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression106{{"PgClassExpression[106∈4]<br />ᐸcount(*)ᐳ"}}:::plan
    __Item111[/"__Item[111∈5]<br />ᐸ79ᐳ"\]:::itemplan
    PgSelectSingle112{{"PgSelectSingle[112∈5]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression114{{"PgClassExpression[114∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    List115{{"List[115∈6]<br />ᐸ114ᐳ"}}:::plan
    PgCursor113{{"PgCursor[113∈6]"}}:::plan
    PgClassExpression117{{"PgClassExpression[117∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgClassExpression118{{"PgClassExpression[118∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgClassExpression119{{"PgClassExpression[119∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgClassExpression120{{"PgClassExpression[120∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan

    %% plan dependencies
    __Value3 --> Access16
    __Value3 --> Access17
    Access16 & Access17 --> Object18
    __InputStaticLeaf11 --> Lambda20
    __InputStaticLeaf7 & Lambda20 --> Connection19
    Lambda20 --> PgValidateParsedCursor26
    Lambda20 --> Access27
    Access27 --> ToPg28
    Object18 & Connection19 & Lambda20 & PgValidateParsedCursor26 & ToPg28 --> PgSelect22
    PgSelect22 --> First23
    First23 --> PgSelectSingle24
    PgSelectSingle24 --> PgClassExpression29
    PgClassExpression29 --> List30
    List30 --> PgCursor25
    PgSelect22 --> Last32
    Last32 --> PgSelectSingle33
    PgSelectSingle33 --> PgClassExpression38
    PgClassExpression38 --> List39
    List39 --> PgCursor34
    PgSelect22 --> Lambda41
    Object18 & Connection19 --> PgSelect46
    PgSelect46 --> First47
    First47 --> PgSelectSingle48
    PgSelectSingle48 --> PgClassExpression49
    PgSelect22 ==> __Item54
    __Item54 --> PgSelectSingle55
    PgSelectSingle55 --> PgClassExpression57
    PgClassExpression57 --> List58
    List58 --> PgCursor56
    PgSelectSingle55 --> PgClassExpression60
    PgSelectSingle55 --> PgClassExpression61
    PgSelectSingle55 --> PgClassExpression62
    PgSelectSingle55 --> PgClassExpression63
    __InputStaticLeaf68 --> Lambda77
    __InputStaticLeaf64 & Lambda77 --> Connection76
    Lambda77 --> PgValidateParsedCursor83
    Lambda77 --> Access84
    Access84 --> ToPg85
    Object18 & Connection76 & Lambda77 & PgValidateParsedCursor83 & ToPg85 --> PgSelect79
    PgSelect79 --> First80
    First80 --> PgSelectSingle81
    PgSelectSingle81 --> PgClassExpression86
    PgClassExpression86 --> List87
    List87 --> PgCursor82
    PgSelect79 --> Last89
    Last89 --> PgSelectSingle90
    PgSelectSingle90 --> PgClassExpression95
    PgClassExpression95 --> List96
    List96 --> PgCursor91
    PgSelect79 --> Lambda98
    Object18 & Connection76 --> PgSelect103
    PgSelect103 --> First104
    First104 --> PgSelectSingle105
    PgSelectSingle105 --> PgClassExpression106
    PgSelect79 ==> __Item111
    __Item111 --> PgSelectSingle112
    PgSelectSingle112 --> PgClassExpression114
    PgClassExpression114 --> List115
    List115 --> PgCursor113
    PgSelectSingle112 --> PgClassExpression117
    PgSelectSingle112 --> PgClassExpression118
    PgSelectSingle112 --> PgClassExpression119
    PgSelectSingle112 --> PgClassExpression120

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,__InputStaticLeaf7,__InputStaticLeaf11,Access16,Access17,Object18,Connection19,Lambda20,__InputStaticLeaf64,__InputStaticLeaf68,Connection76,Lambda77 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19, 20<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: 26, 46<br />ᐳ: 21, 27, 45, 47, 48, 49<br />2: ToPg[28]<br />3: PgSelect[22]<br />ᐳ: 23, 24, 29, 30, 32, 33, 38, 39, 41, 25, 34"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgPageInfo21,PgSelect22,First23,PgSelectSingle24,PgCursor25,PgValidateParsedCursor26,Access27,ToPg28,PgClassExpression29,List30,Last32,PgSelectSingle33,PgCursor34,PgClassExpression38,List39,Lambda41,Constant45,PgSelect46,First47,PgSelectSingle48,PgClassExpression49 bucket1
    Bucket2("Bucket 2 (listItem)<br />ROOT __Item{2}ᐸ22ᐳ[54]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item54,PgSelectSingle55 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 55<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[55]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor56,PgClassExpression57,List58,PgClassExpression60,PgClassExpression61,PgClassExpression62,PgClassExpression63 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 18, 76, 77<br /><br />ROOT Connectionᐸ72ᐳ[76]<br />1: 83, 103<br />ᐳ: 78, 84, 102, 104, 105, 106<br />2: ToPg[85]<br />3: PgSelect[79]<br />ᐳ: 80, 81, 86, 87, 89, 90, 95, 96, 98, 82, 91"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgPageInfo78,PgSelect79,First80,PgSelectSingle81,PgCursor82,PgValidateParsedCursor83,Access84,ToPg85,PgClassExpression86,List87,Last89,PgSelectSingle90,PgCursor91,PgClassExpression95,List96,Lambda98,Constant102,PgSelect103,First104,PgSelectSingle105,PgClassExpression106 bucket4
    Bucket5("Bucket 5 (listItem)<br />ROOT __Item{5}ᐸ79ᐳ[111]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item111,PgSelectSingle112 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 112<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[112]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor113,PgClassExpression114,List115,PgClassExpression117,PgClassExpression118,PgClassExpression119,PgClassExpression120 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
