%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Object19{{"Object[19∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Connection20{{"Connection[20∈0]<br />ᐸ16ᐳ"}}:::plan
    __InputStaticLeaf56{{"__InputStaticLeaf[56∈1]"}}:::plan
    PgSelect21[["PgSelect[21∈1]<br />ᐸpersonᐳ"]]:::plan
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgSelectSingle23{{"PgSelectSingle[23∈2]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression24{{"PgClassExpression[24∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgClassExpression25{{"PgClassExpression[25∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    __InputStaticLeaf27{{"__InputStaticLeaf[27∈1]"}}:::plan
    Connection40{{"Connection[40∈1]<br />ᐸ36ᐳ"}}:::plan
    Access154{{"Access[154∈3]<br />ᐸ22.1ᐳ"}}:::plan
    Reverse155{{"Reverse[155∈3]"}}:::plan
    __Item42[/"__Item[42∈4]<br />ᐸ155ᐳ"\]:::itemplan
    PgSelectSingle43{{"PgSelectSingle[43∈4]<br />ᐸpostᐳ"}}:::plan
    PgClassExpression44{{"PgClassExpression[44∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgClassExpression45{{"PgClassExpression[45∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Connection67{{"Connection[67∈1]<br />ᐸ63ᐳ"}}:::plan
    Access157{{"Access[157∈3]<br />ᐸ22.2ᐳ"}}:::plan
    __Item69[/"__Item[69∈6]<br />ᐸ157ᐳ"\]:::itemplan
    PgSelectSingle70{{"PgSelectSingle[70∈6]<br />ᐸpostᐳ"}}:::plan
    PgClassExpression71{{"PgClassExpression[71∈7]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgClassExpression72{{"PgClassExpression[72∈7]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Connection87{{"Connection[87∈1]<br />ᐸ83ᐳ"}}:::plan
    Access159{{"Access[159∈3]<br />ᐸ22.4ᐳ"}}:::plan
    __Item89[/"__Item[89∈8]<br />ᐸ159ᐳ"\]:::itemplan
    PgSelectSingle90{{"PgSelectSingle[90∈8]<br />ᐸcompoundKeyᐳ"}}:::plan
    PgClassExpression91{{"PgClassExpression[91∈9]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression92{{"PgClassExpression[92∈9]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    Connection107{{"Connection[107∈1]<br />ᐸ103ᐳ"}}:::plan
    Access158{{"Access[158∈3]<br />ᐸ22.3ᐳ"}}:::plan
    __Item109[/"__Item[109∈10]<br />ᐸ158ᐳ"\]:::itemplan
    PgSelectSingle110{{"PgSelectSingle[110∈10]<br />ᐸcompoundKeyᐳ"}}:::plan
    PgClassExpression111{{"PgClassExpression[111∈11]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression112{{"PgClassExpression[112∈11]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    Connection126{{"Connection[126∈0]<br />ᐸ122ᐳ"}}:::plan
    PgSelect127[["PgSelect[127∈12]<br />ᐸcompoundKeyᐳ"]]:::plan
    __Item128[/"__Item[128∈13]<br />ᐸ127ᐳ"\]:::itemplan
    PgSelectSingle129{{"PgSelectSingle[129∈13]<br />ᐸcompoundKeyᐳ"}}:::plan
    PgClassExpression130{{"PgClassExpression[130∈14]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression131{{"PgClassExpression[131∈14]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    Connection147{{"Connection[147∈12]<br />ᐸ143ᐳ"}}:::plan
    Access156{{"Access[156∈14]<br />ᐸ128.0ᐳ"}}:::plan
    __Item149[/"__Item[149∈15]<br />ᐸ156ᐳ"\]:::itemplan
    PgSelectSingle150{{"PgSelectSingle[150∈15]<br />ᐸforeignKeyᐳ"}}:::plan
    PgClassExpression151{{"PgClassExpression[151∈16]<br />ᐸ__foreign_...person_id”ᐳ"}}:::plan
    PgClassExpression152{{"PgClassExpression[152∈16]<br />ᐸ__foreign_...und_key_1”ᐳ"}}:::plan
    PgClassExpression153{{"PgClassExpression[153∈16]<br />ᐸ__foreign_...und_key_2”ᐳ"}}:::plan

    %% plan dependencies
    __Value3 --> Access17
    __Value3 --> Access18
    Access17 & Access18 --> Object19
    Object19 & Connection20 & __InputStaticLeaf56 --> PgSelect21
    PgSelect21 ==> __Item22
    __Item22 --> PgSelectSingle23
    PgSelectSingle23 --> PgClassExpression24
    PgSelectSingle23 --> PgClassExpression25
    __InputStaticLeaf27 --> Connection40
    __Item22 --> Access154
    Access154 --> Reverse155
    Reverse155 ==> __Item42
    __Item42 --> PgSelectSingle43
    PgSelectSingle43 --> PgClassExpression44
    PgSelectSingle43 --> PgClassExpression45
    __Item22 --> Access157
    Access157 ==> __Item69
    __Item69 --> PgSelectSingle70
    PgSelectSingle70 --> PgClassExpression71
    PgSelectSingle70 --> PgClassExpression72
    __Item22 --> Access159
    Access159 ==> __Item89
    __Item89 --> PgSelectSingle90
    PgSelectSingle90 --> PgClassExpression91
    PgSelectSingle90 --> PgClassExpression92
    __Item22 --> Access158
    Access158 ==> __Item109
    __Item109 --> PgSelectSingle110
    PgSelectSingle110 --> PgClassExpression111
    PgSelectSingle110 --> PgClassExpression112
    Object19 & Connection126 --> PgSelect127
    PgSelect127 ==> __Item128
    __Item128 --> PgSelectSingle129
    PgSelectSingle129 --> PgClassExpression130
    PgSelectSingle129 --> PgClassExpression131
    __Item128 --> Access156
    Access156 ==> __Item149
    __Item149 --> PgSelectSingle150
    PgSelectSingle150 --> PgClassExpression151
    PgSelectSingle150 --> PgClassExpression152
    PgSelectSingle150 --> PgClassExpression153

    subgraph "Buckets for queries/v4/relation-head-tail"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,Access17,Access18,Object19,Connection20,Connection126 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 20<br /><br />ROOT Connectionᐸ16ᐳ[20]<br />1: <br />ᐳ: 27, 56, 67, 87, 107, 40<br />2: PgSelect[21]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect21,__InputStaticLeaf27,Connection40,__InputStaticLeaf56,Connection67,Connection87,Connection107 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 40, 67, 87, 107<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgSelectSingle23 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 23, 22, 40, 67, 87, 107<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[23]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression24,PgClassExpression25,Access154,Reverse155,Access157,Access158,Access159 bucket3
    Bucket4("Bucket 4 (listItem)<br />ROOT __Item{4}ᐸ155ᐳ[42]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item42,PgSelectSingle43 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 43<br /><br />ROOT PgSelectSingle{4}ᐸpostᐳ[43]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression44,PgClassExpression45 bucket5
    Bucket6("Bucket 6 (listItem)<br />ROOT __Item{6}ᐸ157ᐳ[69]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item69,PgSelectSingle70 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 70<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[70]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression71,PgClassExpression72 bucket7
    Bucket8("Bucket 8 (listItem)<br />ROOT __Item{8}ᐸ159ᐳ[89]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item89,PgSelectSingle90 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 90<br /><br />ROOT PgSelectSingle{8}ᐸcompoundKeyᐳ[90]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression91,PgClassExpression92 bucket9
    Bucket10("Bucket 10 (listItem)<br />ROOT __Item{10}ᐸ158ᐳ[109]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item109,PgSelectSingle110 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 110<br /><br />ROOT PgSelectSingle{10}ᐸcompoundKeyᐳ[110]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgClassExpression111,PgClassExpression112 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 19, 126<br /><br />ROOT Connectionᐸ122ᐳ[126]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgSelect127,Connection147 bucket12
    Bucket13("Bucket 13 (listItem)<br />Deps: 147<br /><br />ROOT __Item{13}ᐸ127ᐳ[128]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,__Item128,PgSelectSingle129 bucket13
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 129, 128, 147<br /><br />ROOT PgSelectSingle{13}ᐸcompoundKeyᐳ[129]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,PgClassExpression130,PgClassExpression131,Access156 bucket14
    Bucket15("Bucket 15 (listItem)<br />ROOT __Item{15}ᐸ156ᐳ[149]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,__Item149,PgSelectSingle150 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 150<br /><br />ROOT PgSelectSingle{15}ᐸforeignKeyᐳ[150]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression151,PgClassExpression152,PgClassExpression153 bucket16
    Bucket0 --> Bucket1 & Bucket12
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6 & Bucket8 & Bucket10
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket12 --> Bucket13
    Bucket13 --> Bucket14
    Bucket14 --> Bucket15
    Bucket15 --> Bucket16
    end
