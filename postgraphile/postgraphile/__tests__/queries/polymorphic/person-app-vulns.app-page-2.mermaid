%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    __InputStaticLeaf7{{"__InputStaticLeaf[7∈0]"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Object19{{"Object[19∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Connection20{{"Connection[20∈0]<br />ᐸ16ᐳ"}}:::plan
    PgSelect21[["PgSelect[21∈1]<br />ᐸpeopleᐳ"]]:::plan
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgSelectSingle23{{"PgSelectSingle[23∈2]<br />ᐸpeopleᐳ"}}:::plan
    PgClassExpression24{{"PgClassExpression[24∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    PgClassExpression25{{"PgClassExpression[25∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    __InputStaticLeaf26{{"__InputStaticLeaf[26∈1]"}}:::plan
    __InputStaticLeaf30{{"__InputStaticLeaf[30∈0]"}}:::plan
    Lambda40{{"Lambda[40∈0]<br />ᐸparseCursorᐳ"}}:::plan
    Connection39{{"Connection[39∈1]<br />ᐸ35ᐳ"}}:::plan
    PgValidateParsedCursor45["PgValidateParsedCursor[45∈1]"]:::plan
    Access46{{"Access[46∈1]<br />ᐸ40.1ᐳ"}}:::plan
    ToPg47["ToPg[47∈1]"]:::plan
    Access48{{"Access[48∈1]<br />ᐸ40.2ᐳ"}}:::plan
    ToPg49["ToPg[49∈1]"]:::plan
    PgUnionAll41[["PgUnionAll[41∈3]"]]:::plan
    __Item42[/"__Item[42∈4]<br />ᐸ41ᐳ"\]:::itemplan
    PgUnionAllSingle43["PgUnionAllSingle[43∈4]"]:::plan
    Access50{{"Access[50∈5]<br />ᐸ43.Symbol(data).0ᐳ"}}:::plan
    Access51{{"Access[51∈5]<br />ᐸ43.Symbol(data).1ᐳ"}}:::plan
    List52{{"List[52∈5]<br />ᐸ50,51ᐳ"}}:::plan
    PgCursor44{{"PgCursor[44∈5]"}}:::plan
    JSONParse54[["JSONParse[54∈6]<br />ᐸ51ᐳ<br />ᐳAwsApplication"]]:::plan
    Access55{{"Access[55∈6]<br />ᐸ54.0ᐳ"}}:::plan
    PgSelect56[["PgSelect[56∈6]<br />ᐸawsApplicationsᐳ<br />ᐳAwsApplication"]]:::plan
    First60{{"First[60∈6]"}}:::plan
    PgSelectSingle61{{"PgSelectSingle[61∈6]<br />ᐸawsApplicationsᐳ"}}:::plan
    PgClassExpression62{{"PgClassExpression[62∈6]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    __InputStaticLeaf63{{"__InputStaticLeaf[63∈0]"}}:::plan
    Connection76{{"Connection[76∈6]<br />ᐸ72ᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAll77[["PgUnionAll[77∈6]<br />ᐳAwsApplication"]]:::plan
    __Item78[/"__Item[78∈7]<br />ᐸ77ᐳ"\]:::itemplan
    PgUnionAllSingle79["PgUnionAllSingle[79∈7]"]:::plan
    Access81{{"Access[81∈8]<br />ᐸ79.Symbol(data).0ᐳ"}}:::plan
    Access82{{"Access[82∈8]<br />ᐸ79.Symbol(data).1ᐳ"}}:::plan
    List83{{"List[83∈8]<br />ᐸ81,82ᐳ<br />ᐳAwsApplication"}}:::plan
    PgCursor80{{"PgCursor[80∈8]"}}:::plan
    JSONParse85[["JSONParse[85∈9]<br />ᐸ82ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access86{{"Access[86∈9]<br />ᐸ85.0ᐳ"}}:::plan
    PgSelect87[["PgSelect[87∈9]<br />ᐸfirstPartyVulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    First91{{"First[91∈9]"}}:::plan
    PgSelectSingle92{{"PgSelectSingle[92∈9]<br />ᐸfirstPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression93{{"PgClassExpression[93∈9]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    JSONParse95[["JSONParse[95∈9]<br />ᐸ82ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access96{{"Access[96∈9]<br />ᐸ95.0ᐳ"}}:::plan
    PgSelect97[["PgSelect[97∈9]<br />ᐸthirdPartyVulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    First101{{"First[101∈9]"}}:::plan
    PgSelectSingle102{{"PgSelectSingle[102∈9]<br />ᐸthirdPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression103{{"PgClassExpression[103∈9]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    JSONParse105[["JSONParse[105∈6]<br />ᐸ51ᐳ<br />ᐳGcpApplication"]]:::plan
    Access106{{"Access[106∈6]<br />ᐸ105.0ᐳ"}}:::plan
    PgSelect107[["PgSelect[107∈6]<br />ᐸgcpApplicationsᐳ<br />ᐳGcpApplication"]]:::plan
    First111{{"First[111∈6]"}}:::plan
    PgSelectSingle112{{"PgSelectSingle[112∈6]<br />ᐸgcpApplicationsᐳ"}}:::plan
    PgClassExpression113{{"PgClassExpression[113∈6]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    __InputStaticLeaf114{{"__InputStaticLeaf[114∈0]"}}:::plan
    Connection127{{"Connection[127∈6]<br />ᐸ123ᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAll128[["PgUnionAll[128∈6]<br />ᐳGcpApplication"]]:::plan
    __Item129[/"__Item[129∈10]<br />ᐸ128ᐳ"\]:::itemplan
    PgUnionAllSingle130["PgUnionAllSingle[130∈10]"]:::plan
    Access132{{"Access[132∈11]<br />ᐸ130.Symbol(data).0ᐳ"}}:::plan
    Access133{{"Access[133∈11]<br />ᐸ130.Symbol(data).1ᐳ"}}:::plan
    List134{{"List[134∈11]<br />ᐸ132,133ᐳ<br />ᐳGcpApplication"}}:::plan
    PgCursor131{{"PgCursor[131∈11]"}}:::plan
    JSONParse136[["JSONParse[136∈12]<br />ᐸ133ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access137{{"Access[137∈12]<br />ᐸ136.0ᐳ"}}:::plan
    PgSelect138[["PgSelect[138∈12]<br />ᐸfirstPartyVulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    First142{{"First[142∈12]"}}:::plan
    PgSelectSingle143{{"PgSelectSingle[143∈12]<br />ᐸfirstPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression144{{"PgClassExpression[144∈12]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    JSONParse146[["JSONParse[146∈12]<br />ᐸ133ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access147{{"Access[147∈12]<br />ᐸ146.0ᐳ"}}:::plan
    PgSelect148[["PgSelect[148∈12]<br />ᐸthirdPartyVulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    First152{{"First[152∈12]"}}:::plan
    PgSelectSingle153{{"PgSelectSingle[153∈12]<br />ᐸthirdPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression154{{"PgClassExpression[154∈12]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan

    %% plan dependencies
    __Value3 --> Access17
    __Value3 --> Access18
    Access17 & Access18 --> Object19
    __InputStaticLeaf7 --> Connection20
    Object19 & Connection20 --> PgSelect21
    PgSelect21 ==> __Item22
    __Item22 --> PgSelectSingle23
    PgSelectSingle23 --> PgClassExpression24
    PgSelectSingle23 --> PgClassExpression25
    __InputStaticLeaf30 --> Lambda40
    __InputStaticLeaf26 & Lambda40 --> Connection39
    Lambda40 --> PgValidateParsedCursor45
    Lambda40 --> Access46
    Access46 --> ToPg47
    Lambda40 --> Access48
    Access48 --> ToPg49
    Object19 & PgClassExpression24 & PgClassExpression24 & Lambda40 & PgValidateParsedCursor45 & ToPg47 & ToPg49 --> PgUnionAll41
    PgUnionAll41 ==> __Item42
    __Item42 --> PgUnionAllSingle43
    PgUnionAllSingle43 --> Access50
    PgUnionAllSingle43 --> Access51
    Access50 & Access51 --> List52
    List52 --> PgCursor44
    Access51 --> JSONParse54
    JSONParse54 --> Access55
    Object19 & Access55 --> PgSelect56
    PgSelect56 --> First60
    First60 --> PgSelectSingle61
    PgSelectSingle61 --> PgClassExpression62
    __InputStaticLeaf63 --> Connection76
    Object19 & PgClassExpression62 & PgClassExpression62 --> PgUnionAll77
    PgUnionAll77 ==> __Item78
    __Item78 --> PgUnionAllSingle79
    PgUnionAllSingle79 --> Access81
    PgUnionAllSingle79 --> Access82
    Access81 & Access82 --> List83
    List83 --> PgCursor80
    Access82 --> JSONParse85
    JSONParse85 --> Access86
    Object19 & Access86 --> PgSelect87
    PgSelect87 --> First91
    First91 --> PgSelectSingle92
    PgSelectSingle92 --> PgClassExpression93
    Access82 --> JSONParse95
    JSONParse95 --> Access96
    Object19 & Access96 --> PgSelect97
    PgSelect97 --> First101
    First101 --> PgSelectSingle102
    PgSelectSingle102 --> PgClassExpression103
    Access51 --> JSONParse105
    JSONParse105 --> Access106
    Object19 & Access106 --> PgSelect107
    PgSelect107 --> First111
    First111 --> PgSelectSingle112
    PgSelectSingle112 --> PgClassExpression113
    __InputStaticLeaf114 --> Connection127
    Object19 & PgClassExpression113 & PgClassExpression113 --> PgUnionAll128
    PgUnionAll128 ==> __Item129
    __Item129 --> PgUnionAllSingle130
    PgUnionAllSingle130 --> Access132
    PgUnionAllSingle130 --> Access133
    Access132 & Access133 --> List134
    List134 --> PgCursor131
    Access133 --> JSONParse136
    JSONParse136 --> Access137
    Object19 & Access137 --> PgSelect138
    PgSelect138 --> First142
    First142 --> PgSelectSingle143
    PgSelectSingle143 --> PgClassExpression144
    Access133 --> JSONParse146
    JSONParse146 --> Access147
    Object19 & Access147 --> PgSelect148
    PgSelect148 --> First152
    First152 --> PgSelectSingle153
    PgSelectSingle153 --> PgClassExpression154

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,__InputStaticLeaf7,Access17,Access18,Object19,Connection20,__InputStaticLeaf30,Lambda40,__InputStaticLeaf63,__InputStaticLeaf114 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 20, 40, 63, 114<br /><br />ROOT Connectionᐸ16ᐳ[20]<br />1: 21, 45<br />ᐳ: 26, 46, 48, 39<br />2: ToPg[47], ToPg[49]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect21,__InputStaticLeaf26,Connection39,PgValidateParsedCursor45,Access46,ToPg47,Access48,ToPg49 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 19, 40, 45, 47, 49, 63, 114, 39<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgSelectSingle23 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 23, 19, 40, 45, 47, 49, 63, 114, 39<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[23]<br />1: <br />ᐳ: 24, 25<br />2: PgUnionAll[41]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression24,PgClassExpression25,PgUnionAll41 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 19, 63, 114<br /><br />ROOT __Item{4}ᐸ41ᐳ[42]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item42,PgUnionAllSingle43 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 43, 19, 63, 114<br /><br />ROOT PgUnionAllSingle{4}[43]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor44,Access50,Access51,List52 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 51, 19, 63, 114, 43<br />ᐳAwsApplication<br />ᐳGcpApplication<br />1: JSONParse[54], JSONParse[105]<br />ᐳ: 76, 127, 55, 106<br />2: PgSelect[56], PgSelect[107]<br />ᐳ: 60, 61, 62, 111, 112, 113<br />3: PgUnionAll[77], PgUnionAll[128]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse54,Access55,PgSelect56,First60,PgSelectSingle61,PgClassExpression62,Connection76,PgUnionAll77,JSONParse105,Access106,PgSelect107,First111,PgSelectSingle112,PgClassExpression113,Connection127,PgUnionAll128 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 19<br />ᐳAwsApplication<br />ROOT __Item{7}ᐸ77ᐳ[78]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item78,PgUnionAllSingle79 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 79, 19<br />ᐳAwsApplication<br />ROOT PgUnionAllSingle{7}[79]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgCursor80,Access81,Access82,List83 bucket8
    Bucket9("Bucket 9 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 82, 19, 79<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />1: JSONParse[85], JSONParse[95]<br />ᐳ: Access[86], Access[96]<br />2: PgSelect[87], PgSelect[97]<br />ᐳ: 91, 92, 93, 101, 102, 103"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,JSONParse85,Access86,PgSelect87,First91,PgSelectSingle92,PgClassExpression93,JSONParse95,Access96,PgSelect97,First101,PgSelectSingle102,PgClassExpression103 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 19<br />ᐳGcpApplication<br />ROOT __Item{10}ᐸ128ᐳ[129]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item129,PgUnionAllSingle130 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 130, 19<br />ᐳGcpApplication<br />ROOT PgUnionAllSingle{10}[130]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgCursor131,Access132,Access133,List134 bucket11
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 133, 19, 130<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br />1: JSONParse[136], JSONParse[146]<br />ᐳ: Access[137], Access[147]<br />2: PgSelect[138], PgSelect[148]<br />ᐳ: 142, 143, 144, 152, 153, 154"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse136,Access137,PgSelect138,First142,PgSelectSingle143,PgClassExpression144,JSONParse146,Access147,PgSelect148,First152,PgSelectSingle153,PgClassExpression154 bucket12
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket10
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    end
