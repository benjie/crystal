%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    __InputStaticLeaf7{{"__InputStaticLeaf[7∈0]"}}:::plan
    Access16{{"Access[16∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Object18{{"Object[18∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Connection19{{"Connection[19∈0]<br />ᐸ15ᐳ"}}:::plan
    PgSelect20[["PgSelect[20∈1]<br />ᐸpeopleᐳ"]]:::plan
    __Item21[/"__Item[21∈2]<br />ᐸ20ᐳ"\]:::itemplan
    PgSelectSingle22{{"PgSelectSingle[22∈2]<br />ᐸpeopleᐳ"}}:::plan
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    PgClassExpression24{{"PgClassExpression[24∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    __InputStaticLeaf25{{"__InputStaticLeaf[25∈1]"}}:::plan
    __InputStaticLeaf29{{"__InputStaticLeaf[29∈0]"}}:::plan
    Lambda39{{"Lambda[39∈0]<br />ᐸparseCursorᐳ"}}:::plan
    Connection38{{"Connection[38∈1]<br />ᐸ34ᐳ"}}:::plan
    PgValidateParsedCursor44["PgValidateParsedCursor[44∈1]"]:::plan
    Access45{{"Access[45∈1]<br />ᐸ39.1ᐳ"}}:::plan
    ToPg46["ToPg[46∈1]"]:::plan
    Access47{{"Access[47∈1]<br />ᐸ39.2ᐳ"}}:::plan
    ToPg48["ToPg[48∈1]"]:::plan
    PgUnionAll40[["PgUnionAll[40∈3]"]]:::plan
    __Item41[/"__Item[41∈4]<br />ᐸ40ᐳ"\]:::itemplan
    PgUnionAllSingle42["PgUnionAllSingle[42∈4]"]:::plan
    Access49{{"Access[49∈5]<br />ᐸ42.Symbol(data).0ᐳ"}}:::plan
    Access50{{"Access[50∈5]<br />ᐸ42.Symbol(data).1ᐳ"}}:::plan
    List51{{"List[51∈5]<br />ᐸ49,50ᐳ"}}:::plan
    PgCursor43{{"PgCursor[43∈5]"}}:::plan
    JSONParse53[["JSONParse[53∈6]<br />ᐸ50ᐳ<br />ᐳAwsApplication"]]:::plan
    Access54{{"Access[54∈6]<br />ᐸ53.0ᐳ"}}:::plan
    PgSelect55[["PgSelect[55∈6]<br />ᐸawsApplicationsᐳ<br />ᐳAwsApplication"]]:::plan
    First59{{"First[59∈6]"}}:::plan
    PgSelectSingle60{{"PgSelectSingle[60∈6]<br />ᐸawsApplicationsᐳ"}}:::plan
    PgClassExpression61{{"PgClassExpression[61∈6]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    __InputStaticLeaf62{{"__InputStaticLeaf[62∈0]"}}:::plan
    Connection75{{"Connection[75∈6]<br />ᐸ71ᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAll76[["PgUnionAll[76∈6]<br />ᐳAwsApplication"]]:::plan
    __Item77[/"__Item[77∈7]<br />ᐸ76ᐳ"\]:::itemplan
    PgUnionAllSingle78["PgUnionAllSingle[78∈7]"]:::plan
    Access80{{"Access[80∈8]<br />ᐸ78.Symbol(data).0ᐳ"}}:::plan
    Access81{{"Access[81∈8]<br />ᐸ78.Symbol(data).1ᐳ"}}:::plan
    List82{{"List[82∈8]<br />ᐸ80,81ᐳ<br />ᐳAwsApplication"}}:::plan
    PgCursor79{{"PgCursor[79∈8]"}}:::plan
    JSONParse84[["JSONParse[84∈9]<br />ᐸ81ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access85{{"Access[85∈9]<br />ᐸ84.0ᐳ"}}:::plan
    PgSelect86[["PgSelect[86∈9]<br />ᐸfirstPartyVulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    First90{{"First[90∈9]"}}:::plan
    PgSelectSingle91{{"PgSelectSingle[91∈9]<br />ᐸfirstPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression92{{"PgClassExpression[92∈9]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    JSONParse94[["JSONParse[94∈9]<br />ᐸ81ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access95{{"Access[95∈9]<br />ᐸ94.0ᐳ"}}:::plan
    PgSelect96[["PgSelect[96∈9]<br />ᐸthirdPartyVulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    First100{{"First[100∈9]"}}:::plan
    PgSelectSingle101{{"PgSelectSingle[101∈9]<br />ᐸthirdPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression102{{"PgClassExpression[102∈9]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    JSONParse104[["JSONParse[104∈6]<br />ᐸ50ᐳ<br />ᐳGcpApplication"]]:::plan
    Access105{{"Access[105∈6]<br />ᐸ104.0ᐳ"}}:::plan
    PgSelect106[["PgSelect[106∈6]<br />ᐸgcpApplicationsᐳ<br />ᐳGcpApplication"]]:::plan
    First110{{"First[110∈6]"}}:::plan
    PgSelectSingle111{{"PgSelectSingle[111∈6]<br />ᐸgcpApplicationsᐳ"}}:::plan
    PgClassExpression112{{"PgClassExpression[112∈6]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    __InputStaticLeaf113{{"__InputStaticLeaf[113∈0]"}}:::plan
    Connection126{{"Connection[126∈6]<br />ᐸ122ᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAll127[["PgUnionAll[127∈6]<br />ᐳGcpApplication"]]:::plan
    __Item128[/"__Item[128∈10]<br />ᐸ127ᐳ"\]:::itemplan
    PgUnionAllSingle129["PgUnionAllSingle[129∈10]"]:::plan
    Access131{{"Access[131∈11]<br />ᐸ129.Symbol(data).0ᐳ"}}:::plan
    Access132{{"Access[132∈11]<br />ᐸ129.Symbol(data).1ᐳ"}}:::plan
    List133{{"List[133∈11]<br />ᐸ131,132ᐳ<br />ᐳGcpApplication"}}:::plan
    PgCursor130{{"PgCursor[130∈11]"}}:::plan
    JSONParse135[["JSONParse[135∈12]<br />ᐸ132ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access136{{"Access[136∈12]<br />ᐸ135.0ᐳ"}}:::plan
    PgSelect137[["PgSelect[137∈12]<br />ᐸfirstPartyVulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    First141{{"First[141∈12]"}}:::plan
    PgSelectSingle142{{"PgSelectSingle[142∈12]<br />ᐸfirstPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression143{{"PgClassExpression[143∈12]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    JSONParse145[["JSONParse[145∈12]<br />ᐸ132ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access146{{"Access[146∈12]<br />ᐸ145.0ᐳ"}}:::plan
    PgSelect147[["PgSelect[147∈12]<br />ᐸthirdPartyVulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    First151{{"First[151∈12]"}}:::plan
    PgSelectSingle152{{"PgSelectSingle[152∈12]<br />ᐸthirdPartyVulnerabilitiesᐳ"}}:::plan
    PgClassExpression153{{"PgClassExpression[153∈12]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan

    %% plan dependencies
    __Value3 --> Access16
    __Value3 --> Access17
    Access16 & Access17 --> Object18
    __InputStaticLeaf7 --> Connection19
    Object18 & Connection19 --> PgSelect20
    PgSelect20 ==> __Item21
    __Item21 --> PgSelectSingle22
    PgSelectSingle22 --> PgClassExpression23
    PgSelectSingle22 --> PgClassExpression24
    __InputStaticLeaf29 --> Lambda39
    __InputStaticLeaf25 & Lambda39 --> Connection38
    Lambda39 --> PgValidateParsedCursor44
    Lambda39 --> Access45
    Access45 --> ToPg46
    Lambda39 --> Access47
    Access47 --> ToPg48
    Object18 & PgClassExpression23 & PgClassExpression23 & Lambda39 & PgValidateParsedCursor44 & ToPg46 & ToPg48 --> PgUnionAll40
    PgUnionAll40 ==> __Item41
    __Item41 --> PgUnionAllSingle42
    PgUnionAllSingle42 --> Access49
    PgUnionAllSingle42 --> Access50
    Access49 & Access50 --> List51
    List51 --> PgCursor43
    Access50 --> JSONParse53
    JSONParse53 --> Access54
    Object18 & Access54 --> PgSelect55
    PgSelect55 --> First59
    First59 --> PgSelectSingle60
    PgSelectSingle60 --> PgClassExpression61
    __InputStaticLeaf62 --> Connection75
    Object18 & PgClassExpression61 & PgClassExpression61 --> PgUnionAll76
    PgUnionAll76 ==> __Item77
    __Item77 --> PgUnionAllSingle78
    PgUnionAllSingle78 --> Access80
    PgUnionAllSingle78 --> Access81
    Access80 & Access81 --> List82
    List82 --> PgCursor79
    Access81 --> JSONParse84
    JSONParse84 --> Access85
    Object18 & Access85 --> PgSelect86
    PgSelect86 --> First90
    First90 --> PgSelectSingle91
    PgSelectSingle91 --> PgClassExpression92
    Access81 --> JSONParse94
    JSONParse94 --> Access95
    Object18 & Access95 --> PgSelect96
    PgSelect96 --> First100
    First100 --> PgSelectSingle101
    PgSelectSingle101 --> PgClassExpression102
    Access50 --> JSONParse104
    JSONParse104 --> Access105
    Object18 & Access105 --> PgSelect106
    PgSelect106 --> First110
    First110 --> PgSelectSingle111
    PgSelectSingle111 --> PgClassExpression112
    __InputStaticLeaf113 --> Connection126
    Object18 & PgClassExpression112 & PgClassExpression112 --> PgUnionAll127
    PgUnionAll127 ==> __Item128
    __Item128 --> PgUnionAllSingle129
    PgUnionAllSingle129 --> Access131
    PgUnionAllSingle129 --> Access132
    Access131 & Access132 --> List133
    List133 --> PgCursor130
    Access132 --> JSONParse135
    JSONParse135 --> Access136
    Object18 & Access136 --> PgSelect137
    PgSelect137 --> First141
    First141 --> PgSelectSingle142
    PgSelectSingle142 --> PgClassExpression143
    Access132 --> JSONParse145
    JSONParse145 --> Access146
    Object18 & Access146 --> PgSelect147
    PgSelect147 --> First151
    First151 --> PgSelectSingle152
    PgSelectSingle152 --> PgClassExpression153

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,__InputStaticLeaf7,Access16,Access17,Object18,Connection19,__InputStaticLeaf29,Lambda39,__InputStaticLeaf62,__InputStaticLeaf113 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19, 39, 62, 113<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: 20, 44<br />ᐳ: 25, 45, 47, 38<br />2: ToPg[46], ToPg[48]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect20,__InputStaticLeaf25,Connection38,PgValidateParsedCursor44,Access45,ToPg46,Access47,ToPg48 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 18, 39, 44, 46, 48, 62, 113, 38<br /><br />ROOT __Item{2}ᐸ20ᐳ[21]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item21,PgSelectSingle22 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 22, 18, 39, 44, 46, 48, 62, 113, 38<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[22]<br />1: <br />ᐳ: 23, 24<br />2: PgUnionAll[40]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression23,PgClassExpression24,PgUnionAll40 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 18, 62, 113<br /><br />ROOT __Item{4}ᐸ40ᐳ[41]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item41,PgUnionAllSingle42 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 42, 18, 62, 113<br /><br />ROOT PgUnionAllSingle{4}[42]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor43,Access49,Access50,List51 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 50, 18, 62, 113, 42<br />ᐳAwsApplication<br />ᐳGcpApplication<br />1: JSONParse[53], JSONParse[104]<br />ᐳ: 75, 126, 54, 105<br />2: PgSelect[55], PgSelect[106]<br />ᐳ: 59, 60, 61, 110, 111, 112<br />3: PgUnionAll[76], PgUnionAll[127]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse53,Access54,PgSelect55,First59,PgSelectSingle60,PgClassExpression61,Connection75,PgUnionAll76,JSONParse104,Access105,PgSelect106,First110,PgSelectSingle111,PgClassExpression112,Connection126,PgUnionAll127 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 18<br />ᐳAwsApplication<br />ROOT __Item{7}ᐸ76ᐳ[77]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item77,PgUnionAllSingle78 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 78, 18<br />ᐳAwsApplication<br />ROOT PgUnionAllSingle{7}[78]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgCursor79,Access80,Access81,List82 bucket8
    Bucket9("Bucket 9 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 81, 18, 78<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />1: JSONParse[84], JSONParse[94]<br />ᐳ: Access[85], Access[95]<br />2: PgSelect[86], PgSelect[96]<br />ᐳ: 90, 91, 92, 100, 101, 102"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,JSONParse84,Access85,PgSelect86,First90,PgSelectSingle91,PgClassExpression92,JSONParse94,Access95,PgSelect96,First100,PgSelectSingle101,PgClassExpression102 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 18<br />ᐳGcpApplication<br />ROOT __Item{10}ᐸ127ᐳ[128]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item128,PgUnionAllSingle129 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 129, 18<br />ᐳGcpApplication<br />ROOT PgUnionAllSingle{10}[129]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgCursor130,Access131,Access132,List133 bucket11
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 132, 18, 129<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br />1: JSONParse[135], JSONParse[145]<br />ᐳ: Access[136], Access[146]<br />2: PgSelect[137], PgSelect[147]<br />ᐳ: 141, 142, 143, 151, 152, 153"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse135,Access136,PgSelect137,First141,PgSelectSingle142,PgClassExpression143,JSONParse145,Access146,PgSelect147,First151,PgSelectSingle152,PgClassExpression153 bucket12
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket10
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    end
