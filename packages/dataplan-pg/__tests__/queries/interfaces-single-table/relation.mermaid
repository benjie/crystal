graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define plans
    __Value0["__Value[0∈0]"]:::plan
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __InputStaticLeaf7["__InputStaticLeaf[7∈0]"]:::plan
    Access9["Access[9∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access10["Access[10∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object11["Object[11∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    PgSelect8[["PgSelect[8∈0]<br />ᐸsingle_table_itemsᐳ"]]:::plan
    First12["First[12∈0]"]:::plan
    PgSelectSingle13["PgSelectSingle[13∈0]<br />ᐸsingle_table_itemsᐳ"]:::plan
    PgClassExpression14["PgClassExpression[14∈0]<br />ᐸ__single_t...s__.”type”ᐳ"]:::plan
    Lambda15["Lambda[15∈0]"]:::plan
    PgSingleTablePolymorphic16["PgSingleTablePolymorphic[16∈0]"]:::plan
    PgClassExpression17["PgClassExpression[17∈0]<br />ᐸ__single_t...parent_id”ᐳ"]:::plan
    Map299["Map[299∈0]<br />ᐸ13:{”0”:1,”1”:2}ᐳ"]:::plan
    PgSelectSingle23["PgSelectSingle[23∈0]<br />ᐸsingle_table_itemsᐳ"]:::plan
    PgClassExpression24["PgClassExpression[24∈0]<br />ᐸ__single_t...s__.”type”ᐳ"]:::plan
    Lambda25["Lambda[25∈0]"]:::plan
    PgSingleTablePolymorphic26["PgSingleTablePolymorphic[26∈0]"]:::plan
    Map297["Map[297∈0]<br />ᐸ23:{”0”:1}ᐳ"]:::plan
    PgSelectSingle34["PgSelectSingle[34∈0]<br />ᐸpeopleᐳ"]:::plan
    PgClassExpression35["PgClassExpression[35∈0]<br />ᐸ__people__.”username”ᐳ"]:::plan
    PgClassExpression72["PgClassExpression[72∈0]<br />ᐸ__single_t...ems__.”id”ᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access9
    __Value3 --> Access10
    Access9 & Access10 --> Object11
    Object11 & __InputStaticLeaf7 --> PgSelect8
    PgSelect8 --> First12
    First12 --> PgSelectSingle13
    PgSelectSingle13 --> PgClassExpression14
    PgClassExpression14 --> Lambda15
    Lambda15 & PgSelectSingle13 --> PgSingleTablePolymorphic16
    PgSelectSingle13 --> PgClassExpression17
    PgSelectSingle13 --> Map299
    Map299 --> PgSelectSingle23
    PgSelectSingle23 --> PgClassExpression24
    PgClassExpression24 --> Lambda25
    Lambda25 & PgSelectSingle23 --> PgSingleTablePolymorphic26
    PgSelectSingle23 --> Map297
    Map297 --> PgSelectSingle34
    PgSelectSingle34 --> PgClassExpression35
    PgSelectSingle13 --> PgClassExpression72

    %% plan-to-path relationships
    P0["~"]
    __Value0 -.-> P0
    P16["ᐳitem"]
    PgSingleTablePolymorphic16 -.-> P16
    P17["ᐳitemᐳp…tᐳid x25"]
    PgClassExpression17 -.-> P17
    P26["ᐳitemᐳparent x5"]
    PgSingleTablePolymorphic26 -.-> P26
    P34["ᐳitemᐳp…tᐳauthor x25"]
    PgSelectSingle34 -.-> P34
    P35["ᐳitemᐳp…tᐳa…rᐳusername x25"]
    PgClassExpression35 -.-> P35
    P72["ᐳitemᐳid x5"]
    PgClassExpression72 -.-> P72

    subgraph "Buckets for queries/interfaces-single-table/relation"
    Bucket0("Bucket 0 (root)<br />~<br />⠀ROOT ᐸ-O- 0<br />⠀⠀item ᐸ-O- 16<br />⠀⠀⠀item.parent ᐸ-O- 26<br />⠀⠀⠀⠀item.parent.id ᐸ-L- 17<br />⠀⠀⠀⠀item.parent.author ᐸ-O- 34<br />⠀⠀⠀⠀⠀item.parent.author.username ᐸ-L- 35<br />⠀⠀⠀item.id ᐸ-L- 72"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__InputStaticLeaf7,PgSelect8,Access9,Access10,Object11,First12,PgSelectSingle13,PgClassExpression14,Lambda15,PgSingleTablePolymorphic16,PgClassExpression17,PgSelectSingle23,PgClassExpression24,Lambda25,PgSingleTablePolymorphic26,PgSelectSingle34,PgClassExpression35,PgClassExpression72,Map297,Map299 bucket0
    Bucket1("Bucket 1 (polymorphic16[SingleTableTopic|SingleTablePost|SingleTableDivider|SingleTableChecklist|SingleTableChecklistItem])<br />Deps: 12, 13<br />~ᐳQuery.item"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1 bucket1
    Bucket2("Bucket 2 (polymorphic26[SingleTableTopic|SingleTablePost|SingleTableDivider|SingleTableChecklist|SingleTableChecklistItem])<br />Deps: 299, 23<br />~ᐳQuery.itemᐳSingleTablePost.parent<br />~ᐳQuery.itemᐳSingleTableTopic.parent<br />~ᐳQuery.itemᐳSingleTableDivider.parent<br />~ᐳQuery.itemᐳSingleTableChecklist.parent<br />~ᐳQuery.itemᐳSingleTableChecklistItem.parent"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2 bucket2
    Bucket0 --> Bucket1 & Bucket2
    end
