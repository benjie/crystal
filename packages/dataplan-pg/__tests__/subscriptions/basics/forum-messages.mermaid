graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define plans
    __Value0["__Value[0∈0]"]:::plan
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __InputStaticLeaf7["__InputStaticLeaf[7∈0]"]:::plan
    Lambda8["Lambda[8∈0]"]:::plan
    Access9["Access[9∈0]<br />ᐸ3.pgSubscriberᐳ"]:::plan
    Listen10["Listen[10∈0]"]:::plan
    __Item11>"__Item[11∈1]<br />ᐸ10ᐳ"]:::itemplan
    JSONParse12[["JSONParse[12∈1]<br />ᐸ11ᐳ"]]:::plan
    Access14["Access[14∈1]<br />ᐸ12.opᐳ"]:::plan
    Lambda15["Lambda[15∈1]"]:::plan
    Access16["Access[16∈1]<br />ᐸ12.idᐳ"]:::plan
    Access18["Access[18∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access19["Access[19∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object20["Object[20∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    PgSelect17[["PgSelect[17∈1]<br />ᐸmessagesᐳ"]]:::plan
    First21["First[21∈1]"]:::plan
    PgSelectSingle22["PgSelectSingle[22∈1]<br />ᐸmessagesᐳ"]:::plan
    PgClassExpression23["PgClassExpression[23∈1]<br />ᐸ__messages__.”id”ᐳ"]:::plan
    PgClassExpression24["PgClassExpression[24∈1]<br />ᐸ__messages__.”featured”ᐳ"]:::plan
    PgClassExpression25["PgClassExpression[25∈1]<br />ᐸ__messages__.”body”ᐳ"]:::plan
    PgClassExpression26["PgClassExpression[26∈1]<br />ᐸ(__message... not null)ᐳ"]:::plan
    PgClassExpression27["PgClassExpression[27∈1]<br />ᐸ__messages__.”forum_id”ᐳ"]:::plan
    Map47["Map[47∈1]<br />ᐸ22:{”0”:4,”1”:5}ᐳ"]:::plan
    PgSelectSingle33["PgSelectSingle[33∈1]<br />ᐸforumsᐳ"]:::plan
    PgClassExpression35["PgClassExpression[35∈1]<br />ᐸ__forums__.”name”ᐳ"]:::plan
    PgClassExpression36["PgClassExpression[36∈1]<br />ᐸ(__forums_... not null)ᐳ"]:::plan
    Map49["Map[49∈1]<br />ᐸ22:{”0”:7,”1”:8}ᐳ"]:::plan
    PgSelectSingle44["PgSelectSingle[44∈1]<br />ᐸusersᐳ"]:::plan
    PgClassExpression45["PgClassExpression[45∈1]<br />ᐸ__users__.”username”ᐳ"]:::plan
    PgClassExpression46["PgClassExpression[46∈1]<br />ᐸ__users__....vatar_url”ᐳ"]:::plan

    %% plan dependencies
    __InputStaticLeaf7 --> Lambda8
    __Value3 --> Access9
    Access9 & Lambda8 --> Listen10
    Listen10 ==> __Item11
    __Item11 --> JSONParse12
    JSONParse12 --> Access14
    Access14 --> Lambda15
    JSONParse12 --> Access16
    __Value3 --> Access18
    __Value3 --> Access19
    Access18 & Access19 --> Object20
    Object20 & Access16 --> PgSelect17
    PgSelect17 --> First21
    First21 --> PgSelectSingle22
    PgSelectSingle22 --> PgClassExpression23
    PgSelectSingle22 --> PgClassExpression24
    PgSelectSingle22 --> PgClassExpression25
    PgSelectSingle22 --> PgClassExpression26
    PgSelectSingle22 --> PgClassExpression27
    PgSelectSingle22 --> Map47
    Map47 --> PgSelectSingle33
    PgSelectSingle33 --> PgClassExpression35
    PgSelectSingle33 --> PgClassExpression36
    PgSelectSingle22 --> Map49
    Map49 --> PgSelectSingle44
    PgSelectSingle44 --> PgClassExpression45
    PgSelectSingle44 --> PgClassExpression46

    %% plan-to-path relationships
    P0["~"]
    __Value0 -.-> P0
    P10["~"]
    Listen10 -.-> P10
    P12["ᐳforumMessage"]
    JSONParse12 -.-> P12
    P15["ᐳf…eᐳoperationType"]
    Lambda15 -.-> P15
    P22["ᐳf…eᐳmessage"]
    PgSelectSingle22 -.-> P22
    P23["ᐳf…eᐳm…eᐳid"]
    PgClassExpression23 -.-> P23
    P24["ᐳf…eᐳm…eᐳfeatured"]
    PgClassExpression24 -.-> P24
    P25["ᐳf…eᐳm…eᐳbody"]
    PgClassExpression25 -.-> P25
    P26["ᐳf…eᐳm…eᐳisArchived"]
    PgClassExpression26 -.-> P26
    P27["ᐳf…eᐳm…eᐳf…mᐳid"]
    PgClassExpression27 -.-> P27
    P33["ᐳf…eᐳm…eᐳforum<br />ᐳf…eᐳm…eᐳf…mᐳself"]
    PgSelectSingle33 -.-> P33
    P35["ᐳf…eᐳm…eᐳf…mᐳname<br />ᐳf…eᐳm…eᐳf…mᐳselfᐳname"]
    PgClassExpression35 -.-> P35
    P36["ᐳf…eᐳm…eᐳf…mᐳisArchived"]
    PgClassExpression36 -.-> P36
    P44["ᐳf…eᐳm…eᐳauthor"]
    PgSelectSingle44 -.-> P44
    P45["ᐳf…eᐳm…eᐳa…rᐳusername"]
    PgClassExpression45 -.-> P45
    P46["ᐳf…eᐳm…eᐳa…rᐳgravatarUrl"]
    PgClassExpression46 -.-> P46

    subgraph "Buckets for subscriptions/basics/forum-messages"
    Bucket0("Bucket 0 (root)<br />~"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__InputStaticLeaf7,Lambda8,Access9,Listen10,Access18,Access19,Object20 bucket0
    Bucket1("Bucket 1 (item11)<br />Deps: 10, 20<br />~"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item11,JSONParse12,Access14,Lambda15,Access16,PgSelect17,First21,PgSelectSingle22,PgClassExpression23,PgClassExpression24,PgClassExpression25,PgClassExpression26,PgClassExpression27,PgSelectSingle33,PgClassExpression35,PgClassExpression36,PgSelectSingle44,PgClassExpression45,PgClassExpression46,Map47,Map49 bucket1
    Bucket0 --> Bucket1
    end
